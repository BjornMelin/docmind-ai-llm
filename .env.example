# DocMind AI Configuration - Environment Variables
# Copy this file to .env and customize for your environment

# ============================================================================
# CONFIGURATION FORMAT
# ============================================================================
# NESTED FORMAT: Use double underscore (__) for nested configuration access
# Example: DOCMIND_VLLM__TEMPERATURE=0.1 maps to settings.vllm.temperature
# This fixes configuration loading issues where defaults were used instead of user settings

# CONVERSION SUMMARY:
# - DOCMIND_VLLM__* → settings.vllm.* (model, temperature, context_window, etc.)
# - DOCMIND_AGENTS__* → settings.agents.* (decision_timeout, max_retries, etc.)
# - DOCMIND_EMBEDDING__* → settings.embedding.* (model_name, dimension, etc.)
# - DOCMIND_RETRIEVAL__* → settings.retrieval.* (strategy, top_k, reranker_model, etc.)
# - DOCMIND_PROCESSING__* → settings.processing.* (chunk_size, max_document_size_mb, etc.)
# - DOCMIND_CACHE__* → settings.cache.* (enable_document_caching, etc.)
# - Flat variables remain for top-level settings (app_name, debug, log_level, etc.)

# ============================================================================
# CORE APPLICATION SETTINGS (FLAT FORMAT - TOP LEVEL)
# ============================================================================

# Application metadata (flat - maps to settings.app_name, settings.app_version, settings.debug)
DOCMIND_APP_NAME="DocMind AI"
DOCMIND_APP_VERSION="2.0.0"
DOCMIND_DEBUG=false

# Backend configuration (flat - maps to settings.llm_backend)
DOCMIND_LLM_BACKEND=ollama

# (Deprecated) legacy flat variable examples may be ignored by nested config mapping
# Use nested DOCMIND__ variables documented below.

# ============================================================================
# MULTI-AGENT COORDINATION SYSTEM (NESTED FORMAT)
# ============================================================================

# Enable multi-agent system (5 specialized agents) 
DOCMIND_AGENTS__ENABLE_MULTI_AGENT=true

# Agent operation timeouts
DOCMIND_AGENTS__DECISION_TIMEOUT=200

# Retry and fallback behavior
DOCMIND_AGENTS__MAX_RETRIES=2
DOCMIND_AGENTS__ENABLE_FALLBACK_RAG=true
DOCMIND_AGENTS__MAX_CONCURRENT_AGENTS=3

# Parallel execution optimization
DOCMIND_AGENTS__ENABLE_PARALLEL_TOOL_EXECUTION=true

# Context management
DOCMIND_AGENTS__CONTEXT_BUFFER_SIZE=131072

# Legacy flat variables (no nested equivalent - keep flat)
DOCMIND_MAX_PARALLEL_TOOL_CALLS=3
DOCMIND_TOKEN_REDUCTION_TARGET=0.50

# ============================================================================
# LLM CONFIGURATION (NESTED FORMAT)
# ============================================================================

# Primary model (FP8 optimized for RTX 4090)
DOCMIND_VLLM__MODEL=Qwen/Qwen3-4B-Instruct-2507-FP8

# LLM backend endpoint (maps to ollama_base_url)
DOCMIND_OLLAMA_BASE_URL=http://localhost:11434
# LM Studio endpoint (top-level; always OpenAI-compatible /v1)
DOCMIND_LMSTUDIO_BASE_URL=http://localhost:1234/v1
# vLLM base URL (no /v1 by default). If running OpenAI-compatible server, use /v1.
DOCMIND_VLLM__VLLM_BASE_URL=http://localhost:8000
# For OpenAI-compatible vLLM server:
# DOCMIND_VLLM__VLLM_BASE_URL=http://localhost:8000/v1

# Generation parameters (NESTED FORMAT)
DOCMIND_VLLM__TEMPERATURE=0.1
DOCMIND_VLLM__MAX_TOKENS=2048

# Context window (128K for Qwen3 with FP8 optimization)
DOCMIND_VLLM__CONTEXT_WINDOW=131072

# UI timeouts (nested mapping)
DOCMIND_UI__REQUEST_TIMEOUT_SECONDS=120

# OpenAI-like flags for OpenAI-compatible servers (LM Studio, vLLM OpenAI mode, llama-cpp server)
DOCMIND_OPENAI_LIKE_API_KEY=not-needed
DOCMIND_OPENAI_LIKE_IS_CHAT_MODEL=true
DOCMIND_OPENAI_LIKE_IS_FUNCTION_CALLING_MODEL=false
# Optional JSON headers
# DOCMIND_OPENAI_LIKE_EXTRA_HEADERS={"x-custom":"1"}

# Global LLM client behavior (flat mapping)
DOCMIND_LLM_REQUEST_TIMEOUT_SECONDS=120
DOCMIND_LLM_STREAMING_ENABLED=true

# ============================================================================
# EMBEDDING & RETRIEVAL CONFIGURATION (NESTED FORMAT)
# ============================================================================

# BGE-M3 unified dense/sparse embeddings (NESTED FORMAT)
DOCMIND_EMBEDDING__MODEL_NAME=BAAI/bge-m3

# BGE-M3 specific configuration (NESTED FORMAT)
DOCMIND_EMBEDDING__DIMENSION=1024
DOCMIND_EMBEDDING__MAX_LENGTH=8192
DOCMIND_EMBEDDING__BATCH_SIZE_GPU=12
DOCMIND_EMBEDDING__BATCH_SIZE_CPU=4

# Document processing optimized for BGE-M3 8K context (NESTED FORMAT)
DOCMIND_PROCESSING__CHUNK_SIZE=1024
DOCMIND_PROCESSING__CHUNK_OVERLAP=100
DOCMIND_PROCESSING__NEW_AFTER_N_CHARS=1200
DOCMIND_PROCESSING__COMBINE_TEXT_UNDER_N_CHARS=500
DOCMIND_PROCESSING__MULTIPAGE_SECTIONS=true
DOCMIND_PROCESSING__DEBUG_CHUNK_FLOW=false

# Retrieval strategy with RRF fusion (NESTED FORMAT)
DOCMIND_RETRIEVAL__STRATEGY=hybrid
DOCMIND_RETRIEVAL__TOP_K=10
DOCMIND_RETRIEVAL__USE_RERANKING=true
DOCMIND_RETRIEVAL__RERANKING_TOP_K=5
DOCMIND_RETRIEVAL__USE_SPARSE_EMBEDDINGS=true

# RRF Fusion settings (NESTED FORMAT)
DOCMIND_RETRIEVAL__RRF_ALPHA=60
DOCMIND_RETRIEVAL__RRF_K_CONSTANT=60

# Reranking model with performance settings (NESTED FORMAT)
DOCMIND_RETRIEVAL__RERANKER_MODEL=BAAI/bge-reranker-v2-m3
DOCMIND_RETRIEVAL__RERANKER_NORMALIZE_SCORES=true

# Legacy flat variables (no nested equivalent - keep flat)
# (Optional) Reranking testing overrides (example only)
# DOCMIND_MONITORING__DEFAULT_BATCH_SIZE=20

# ============================================================================
# DOCUMENT PROCESSING (NESTED FORMAT)
# ============================================================================

# Document size limits (NESTED FORMAT)
DOCMIND_PROCESSING__MAX_DOCUMENT_SIZE_MB=100

# Processing caching (NESTED FORMAT)
DOCMIND_CACHE__ENABLE_DOCUMENT_CACHING=true
DOCMIND_CACHE__TTL_SECONDS=3600
DOCMIND_CACHE__MAX_SIZE_MB=1000

# Legacy flat variables (no nested equivalent - keep flat)
DOCMIND_PARSE_STRATEGY=hi_res
DOCMIND_EMBEDDING_BATCH_SIZE=100
DOCMIND_DEFAULT_BATCH_SIZE=20

# ============================================================================
# VECTOR DATABASE (QDRANT) - FLAT FORMAT
# ============================================================================

# Vector store configuration (nested mapping)
DOCMIND_DATABASE__SQLITE_DB_PATH=./data/docmind.db
DOCMIND_DATABASE__ENABLE_WAL_MODE=true
DOCMIND_DATABASE__QDRANT_URL=http://localhost:6333
DOCMIND_DATABASE__QDRANT_COLLECTION=docmind_docs
DOCMIND_DATABASE__QDRANT_TIMEOUT=60

# ============================================================================
# PERFORMANCE & GPU OPTIMIZATION (MIXED FORMAT)
# ============================================================================

# GPU acceleration (flat - maps to settings.enable_gpu_acceleration)
DOCMIND_ENABLE_GPU_ACCELERATION=true

 # Resource limits (nested mapping)
DOCMIND_MONITORING__MAX_MEMORY_GB=4.0
DOCMIND_MONITORING__MAX_VRAM_GB=14.0
DOCMIND_MONITORING__MAX_QUERY_LATENCY_MS=2000

# Legacy flat variables (no nested equivalent yet)
DOCMIND_QUANT_POLICY=fp8

# vLLM Performance Settings (FP8 optimized) - NESTED FORMAT
DOCMIND_VLLM__GPU_MEMORY_UTILIZATION=0.95
DOCMIND_VLLM__ATTENTION_BACKEND=FLASHINFER
DOCMIND_VLLM__ENABLE_CHUNKED_PREFILL=true
DOCMIND_VLLM__MAX_NUM_BATCHED_TOKENS=8192
DOCMIND_VLLM__MAX_NUM_SEQS=16
DOCMIND_VLLM__VLLM_BASE_URL=http://localhost:8000

# Additional vLLM environment variables
VLLM_ATTENTION_BACKEND=FLASHINFER
VLLM_KV_CACHE_DTYPE=fp8_e5m2
VLLM_GPU_MEMORY_UTILIZATION=0.95
VLLM_USE_CUDNN_PREFILL=1
VLLM_CALCULATE_KV_SCALES=true
VLLM_ENABLE_CHUNKED_PREFILL=true

# RESTORED: Complete vLLM server configuration for optimal GPU performance
VLLM_TORCH_BACKEND=cu128
VLLM_MODEL=Qwen/Qwen3-4B-Instruct-2507-FP8
VLLM_TENSOR_PARALLEL_SIZE=1
VLLM_MAX_MODEL_LEN=131072
VLLM_ENABLE_PREFIX_CACHING=true
VLLM_USE_V2_BLOCK_MANAGER=true
VLLM_QUANTIZATION=fp8
VLLM_MAX_NUM_SEQS=256

# RESTORED: PyTorch and CUDA configuration
PYTORCH_CUDA_ALLOC_CONF=max_split_size_mb:512
TOKENIZERS_PARALLELISM=false

# RESTORED: CUDA environment variables (critical for GPU detection)
CUDA_VISIBLE_DEVICES=0
NVIDIA_VISIBLE_DEVICES=all
CUDA_HOME=/usr/local/cuda

# ============================================================================
# FILE SYSTEM & PERSISTENCE (FLAT FORMAT - TOP LEVEL)
# ============================================================================

# Data directories (flat - maps to settings.data_dir, settings.cache_dir)
DOCMIND_DATA_DIR=./data
DOCMIND_CACHE_DIR=./cache

# ============================================================================
# ANALYTICS (ADR-032) & BACKUP (ADR-033)
# ============================================================================

# Enable optional local DuckDB analytics database (off by default)
DOCMIND_ANALYTICS_ENABLED=false
# Days to retain analytics records
DOCMIND_ANALYTICS_RETENTION_DAYS=60
# Optional override for analytics DB path (default: data/analytics/analytics.duckdb)
# DOCMIND_ANALYTICS_DB_PATH=./data/analytics/analytics.duckdb

# Enable manual local backups with simple rotation (off by default)
DOCMIND_BACKUP_ENABLED=false
# Keep last N backups when rotating
DOCMIND_BACKUP_KEEP_LAST=7

# Logging (flat - maps to settings.log_file, settings.log_level, settings.enable_performance_logging)
DOCMIND_LOG_FILE=./logs/docmind.log
DOCMIND_LOG_LEVEL=INFO
DOCMIND_MONITORING__ENABLE_PERFORMANCE_LOGGING=true

# ============================================================================
# USER INTERFACE (FLAT FORMAT - TOP LEVEL)
# ============================================================================

# Streamlit configuration (flat - maps to settings.streamlit_port, settings.enable_ui_dark_mode)
DOCMIND_STREAMLIT_PORT=8501
DOCMIND_ENABLE_UI_DARK_MODE=true

# ============================================================================
# ADVANCED FEATURES (EXPERIMENTAL) - FLAT FORMAT
# ============================================================================

# GraphRAG for relationship queries (flat - maps to top-level experimental settings)
DOCMIND_ENABLE_GRAPHRAG=false
DOCMIND_GRAPHRAG_MAX_TRIPLETS=1000
DOCMIND_GRAPHRAG_CHUNK_SIZE=1024

# Multimodal document processing (flat - maps to top-level experimental settings)
DOCMIND_ENABLE_MULTIMODAL=false

# DSPy prompt optimization (flat - maps to top-level experimental settings)
DOCMIND_ENABLE_DSPY_OPTIMIZATION=true
DOCMIND_DSPY_OPTIMIZATION_SAMPLES=20
DOCMIND_DSPY_MAX_RETRIES=3
DOCMIND_DSPY_TEMPERATURE=0.1

# Analysis modes configuration (flat - maps to top-level experimental settings)
DOCMIND_ANALYSIS_MODES=detailed,summary,comparison

# ============================================================================
# DEVELOPMENT & DEBUGGING
# ============================================================================

# IMPORTANT: Variables above have been converted to nested format to fix configuration loading!
# Use the nested format when uncommenting for development:

# Additional logging for development (FLAT - correct as is)
# DOCMIND_LOG_LEVEL=DEBUG

# Reduce timeouts for faster development cycles (USE NESTED FORMAT)
# DOCMIND_AGENTS__DECISION_TIMEOUT=100
# DOCMIND_UI__REQUEST_TIMEOUT_SECONDS=30

# Use smaller context for faster processing during development (USE NESTED FORMAT)
# DOCMIND_VLLM__CONTEXT_WINDOW=8192
# DOCMIND_PROCESSING__CHUNK_SIZE=256

# ============================================================================
# PRODUCTION OPTIMIZATIONS
# ============================================================================

# For production deployment, use the correct nested format:
# DOCMIND_AGENTS__MAX_CONCURRENT_AGENTS=5
# DOCMIND_EMBEDDING__BATCH_SIZE_GPU=200
# DOCMIND_VLLM__GPU_MEMORY_UTILIZATION=0.90
# DOCMIND_MONITORING__ENABLE_PERFORMANCE_LOGGING=true
# DOCMIND_LOG_LEVEL=WARNING
