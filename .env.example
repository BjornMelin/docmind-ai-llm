# DocMind AI Configuration - Environment Variables
# Copy this file to .env and customize for your environment

# ============================================================================
# CONFIGURATION FORMAT
# ============================================================================
# NESTED FORMAT: Use double underscore (__) for nested configuration access
# Example: DOCMIND_VLLM__TEMPERATURE=0.1 maps to settings.vllm.temperature
# This fixes configuration loading issues where defaults were used instead of user settings

# CONVERSION SUMMARY:
# - DOCMIND_VLLM__* → settings.vllm.* (model, temperature, context_window, etc.)
# - DOCMIND_AGENTS__* → settings.agents.* (decision_timeout, max_retries, etc.)
# - DOCMIND_EMBEDDING__* → settings.embedding.* (model_name, dimension, etc.)
# - DOCMIND_RETRIEVAL__* → settings.retrieval.* (strategy, top_k, reranker_model, etc.)
# - DOCMIND_PROCESSING__* → settings.processing.* (chunk_size, max_document_size_mb, etc.)
# - DOCMIND_CACHE__* → settings.cache.* (enable_document_caching, etc.)
# - Flat variables remain for top-level settings (app_name, debug, log_level, etc.)

# ============================================================================
# CORE APPLICATION SETTINGS (FLAT FORMAT - TOP LEVEL)
# ============================================================================

# Application metadata (flat - maps to settings.app_name, settings.app_version, settings.debug)
DOCMIND_APP_NAME="DocMind AI"
DOCMIND_APP_VERSION="2.0.0"
DOCMIND_DEBUG=false

# Backend configuration (flat - maps to settings.llm_backend)
DOCMIND_LLM_BACKEND=ollama

# Context management (flat - maps to settings.enable_conversation_memory)
DOCMIND_ENABLE_CONVERSATION_MEMORY=true

# ============================================================================
# MULTI-AGENT COORDINATION SYSTEM (NESTED FORMAT)
# ============================================================================

# Enable multi-agent system (5 specialized agents) 
DOCMIND_AGENTS__ENABLE_MULTI_AGENT=true

# Agent operation timeouts
DOCMIND_AGENTS__DECISION_TIMEOUT=200

# Retry and fallback behavior
DOCMIND_AGENTS__MAX_RETRIES=2
DOCMIND_AGENTS__ENABLE_FALLBACK_RAG=true
DOCMIND_AGENTS__MAX_CONCURRENT_AGENTS=3

# Parallel execution optimization
DOCMIND_AGENTS__ENABLE_PARALLEL_TOOL_EXECUTION=true

# Context management
DOCMIND_AGENTS__CONTEXT_BUFFER_SIZE=131072

# Legacy flat variables (no nested equivalent - keep flat)
DOCMIND_MAX_PARALLEL_TOOL_CALLS=3
DOCMIND_TOKEN_REDUCTION_TARGET=0.50

# ============================================================================
# LLM CONFIGURATION (NESTED FORMAT)
# ============================================================================

# Primary model (FP8 optimized for RTX 4090)
DOCMIND_VLLM__MODEL=Qwen/Qwen3-4B-Instruct-2507-FP8

# LLM backend endpoint (maps to ollama_base_url)
DOCMIND_OLLAMA_BASE_URL=http://localhost:11434

# Generation parameters (NESTED FORMAT)
DOCMIND_VLLM__TEMPERATURE=0.1
DOCMIND_VLLM__MAX_TOKENS=2048

# Context window (128K for Qwen3 with FP8 optimization)
DOCMIND_VLLM__CONTEXT_WINDOW=131072

# Legacy flat variables (no nested equivalent - keep flat)
DOCMIND_REQUEST_TIMEOUT=120

# ============================================================================
# EMBEDDING & RETRIEVAL CONFIGURATION (NESTED FORMAT)
# ============================================================================

# BGE-M3 unified dense/sparse embeddings (NESTED FORMAT)
DOCMIND_EMBEDDING__MODEL_NAME=BAAI/bge-m3

# BGE-M3 specific configuration (NESTED FORMAT)
DOCMIND_EMBEDDING__DIMENSION=1024
DOCMIND_EMBEDDING__MAX_LENGTH=8192
DOCMIND_EMBEDDING__BATCH_SIZE_GPU=12
DOCMIND_EMBEDDING__BATCH_SIZE_CPU=4

# Document processing optimized for BGE-M3 8K context (NESTED FORMAT)
DOCMIND_PROCESSING__CHUNK_SIZE=1024
DOCMIND_PROCESSING__CHUNK_OVERLAP=100

# Retrieval strategy with RRF fusion (NESTED FORMAT)
DOCMIND_RETRIEVAL__STRATEGY=hybrid
DOCMIND_RETRIEVAL__TOP_K=10
DOCMIND_RETRIEVAL__USE_RERANKING=true
DOCMIND_RETRIEVAL__RERANKING_TOP_K=5
DOCMIND_RETRIEVAL__USE_SPARSE_EMBEDDINGS=true

# RRF Fusion settings (NESTED FORMAT)
DOCMIND_RETRIEVAL__RRF_ALPHA=60
DOCMIND_RETRIEVAL__RRF_K_CONSTANT=60

# Reranking model with performance settings (NESTED FORMAT)
DOCMIND_RETRIEVAL__RERANKER_MODEL=BAAI/bge-reranker-v2-m3

# Legacy flat variables (no nested equivalent - keep flat)
DOCMIND_RERANKING_BATCH_SIZE=20
DOCMIND_RERANKING_TIMEOUT_MS=100
DOCMIND_RERANKING_USE_GPU=true

# ============================================================================
# DOCUMENT PROCESSING (NESTED FORMAT)
# ============================================================================

# Document size limits (NESTED FORMAT)
DOCMIND_PROCESSING__MAX_DOCUMENT_SIZE_MB=100

# Processing caching (NESTED FORMAT)
DOCMIND_CACHE__ENABLE_DOCUMENT_CACHING=true

# Legacy flat variables (no nested equivalent - keep flat)
DOCMIND_PARSE_STRATEGY=hi_res
DOCMIND_EMBEDDING_BATCH_SIZE=100
DOCMIND_DEFAULT_BATCH_SIZE=20

# ============================================================================
# VECTOR DATABASE (QDRANT) - FLAT FORMAT
# ============================================================================

# Vector store configuration (flat - maps to top-level settings)
DOCMIND_VECTOR_STORE_TYPE=qdrant
DOCMIND_QDRANT_URL=http://localhost:6333
DOCMIND_QDRANT_COLLECTION=docmind_docs

# ============================================================================
# PERFORMANCE & GPU OPTIMIZATION (MIXED FORMAT)
# ============================================================================

# GPU acceleration (flat - maps to settings.enable_gpu_acceleration)
DOCMIND_ENABLE_GPU_ACCELERATION=true

# Resource limits (flat - maps to top-level performance settings)
DOCMIND_MAX_MEMORY_GB=4.0
DOCMIND_MAX_VRAM_GB=14.0
DOCMIND_MAX_QUERY_LATENCY_MS=2000

# Legacy flat variables (no nested equivalent yet)
DOCMIND_QUANT_POLICY=fp8

# vLLM Performance Settings (FP8 optimized) - NESTED FORMAT
DOCMIND_VLLM__GPU_MEMORY_UTILIZATION=0.95
DOCMIND_VLLM__ATTENTION_BACKEND=FLASHINFER
DOCMIND_VLLM__ENABLE_CHUNKED_PREFILL=true
DOCMIND_VLLM__MAX_NUM_BATCHED_TOKENS=8192
DOCMIND_VLLM__MAX_NUM_SEQS=16

# Additional vLLM environment variables
VLLM_ATTENTION_BACKEND=FLASHINFER
VLLM_KV_CACHE_DTYPE=fp8_e5m2
VLLM_GPU_MEMORY_UTILIZATION=0.95
VLLM_USE_CUDNN_PREFILL=1
VLLM_CALCULATE_KV_SCALES=true
VLLM_ENABLE_CHUNKED_PREFILL=true

# RESTORED: Complete vLLM server configuration for optimal GPU performance
VLLM_TORCH_BACKEND=cu128
VLLM_MODEL=Qwen/Qwen3-4B-Instruct-2507-FP8
VLLM_TENSOR_PARALLEL_SIZE=1
VLLM_MAX_MODEL_LEN=131072
VLLM_ENABLE_PREFIX_CACHING=true
VLLM_USE_V2_BLOCK_MANAGER=true
VLLM_QUANTIZATION=fp8
VLLM_MAX_NUM_SEQS=256

# RESTORED: PyTorch and CUDA configuration
PYTORCH_CUDA_ALLOC_CONF=max_split_size_mb:512
TOKENIZERS_PARALLELISM=false

# RESTORED: CUDA environment variables (critical for GPU detection)
CUDA_VISIBLE_DEVICES=0
NVIDIA_VISIBLE_DEVICES=all
CUDA_HOME=/usr/local/cuda

# ============================================================================
# FILE SYSTEM & PERSISTENCE (FLAT FORMAT - TOP LEVEL)
# ============================================================================

# Data directories (flat - maps to settings.data_dir, settings.cache_dir)
DOCMIND_DATA_DIR=./data
DOCMIND_CACHE_DIR=./cache

# Database (flat - maps to settings.sqlite_db_path, settings.enable_wal_mode)
DOCMIND_SQLITE_DB_PATH=./data/docmind.db
DOCMIND_ENABLE_WAL_MODE=true

# Logging (flat - maps to settings.log_file, settings.log_level, settings.enable_performance_logging)
DOCMIND_LOG_FILE=./logs/docmind.log
DOCMIND_LOG_LEVEL=INFO
DOCMIND_ENABLE_PERFORMANCE_LOGGING=true

# ============================================================================
# USER INTERFACE (FLAT FORMAT - TOP LEVEL)
# ============================================================================

# Streamlit configuration (flat - maps to settings.streamlit_port, settings.enable_ui_dark_mode)
DOCMIND_STREAMLIT_PORT=8501
DOCMIND_ENABLE_UI_DARK_MODE=true

# ============================================================================
# ADVANCED FEATURES (EXPERIMENTAL) - FLAT FORMAT
# ============================================================================

# GraphRAG for relationship queries (flat - maps to top-level experimental settings)
DOCMIND_ENABLE_GRAPHRAG=false
DOCMIND_GRAPHRAG_MAX_TRIPLETS=1000
DOCMIND_GRAPHRAG_CHUNK_SIZE=1024

# Multimodal document processing (flat - maps to top-level experimental settings)
DOCMIND_ENABLE_MULTIMODAL=false

# DSPy prompt optimization (flat - maps to top-level experimental settings)
DOCMIND_ENABLE_DSPY_OPTIMIZATION=true
DOCMIND_DSPY_OPTIMIZATION_SAMPLES=20
DOCMIND_DSPY_MAX_RETRIES=3
DOCMIND_DSPY_TEMPERATURE=0.1

# Analysis modes configuration (flat - maps to top-level experimental settings)
DOCMIND_ANALYSIS_MODES=detailed,summary,comparison

# ============================================================================
# DEVELOPMENT & DEBUGGING
# ============================================================================

# IMPORTANT: Variables above have been converted to nested format to fix configuration loading!
# Use the nested format when uncommenting for development:

# Additional logging for development (FLAT - correct as is)
# DOCMIND_LOG_LEVEL=DEBUG

# Reduce timeouts for faster development cycles (USE NESTED FORMAT)
# DOCMIND_AGENTS__DECISION_TIMEOUT=100
# DOCMIND_REQUEST_TIMEOUT=30

# Use smaller context for faster processing during development (USE NESTED FORMAT)
# DOCMIND_VLLM__CONTEXT_WINDOW=8192
# DOCMIND_PROCESSING__CHUNK_SIZE=256

# ============================================================================
# PRODUCTION OPTIMIZATIONS
# ============================================================================

# For production deployment, use the correct nested format:
# DOCMIND_AGENTS__MAX_CONCURRENT_AGENTS=5
# DOCMIND_EMBEDDING_BATCH_SIZE=200
# DOCMIND_VLLM__GPU_MEMORY_UTILIZATION=0.90
# DOCMIND_ENABLE_PERFORMANCE_LOGGING=true
# DOCMIND_LOG_LEVEL=WARNING
