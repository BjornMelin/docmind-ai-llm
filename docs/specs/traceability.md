# Requirements Traceability Matrix (RTM)

| ID | Title | Source | ADR(s) | Code file(s) | Test(s) | Verification | Status |
|----|-------|--------|--------|--------------|---------|--------------|--------|
| FR-001 | Unstructured ingest auto+OCR | ADR-002 | 002 | src/processing/document_processor.py; src/processing/utils.py | tests/unit/processing/test_document_processor.py; tests/unit/processing/test_unstructured_transformation_config.py; tests/integration/test_ingestion_pipeline_pdf_images.py | test | Completed |
| FR-002 | LlamaIndex pipeline cache | ADR-010 | 010 | src/processing/document_processor.py | tests/unit/cache/test_ingestion_cache.py; tests/integration/test_ingestion_pipeline_pdf_images.py | test+analysis | Completed |
| FR-003 | Deterministic IDs + pdf_page_image | ADR-002 | 002 | src/processing/document_processor.py; src/processing/pdf_pages.py; src/models/schemas.py | tests/unit/processing/test_pdf_pages_helpers.py; tests/unit/processing/test_deterministic_ids.py; tests/integration/test_ingestion_pipeline_pdf_images.py | test | Completed |
| FR-004 | BGE‑M3 + SigLIP default (OpenCLIP optional) | ADR‑002 | 002 | src/config/integrations.py; src/models/embeddings.py; src/utils/multimodal.py | tests/unit/retrieval/embeddings/test_embeddings_refactored.py; tests/unit/models/embeddings/test_bge_m3_text_embedder.py; tests/unit/models/embeddings/test_image_embedder.py; tests/integration/test_unified_embeddings_in_retrieval_integration.py | test | Completed |
| FR-005 | Qdrant server‑side hybrid (RRF default; DBSF env‑gated) | ADR‑005/006 | 005,006 | src/retrieval/hybrid.py; src/utils/storage.py | tests/unit/retrieval/dedup/test_dedup_before_final_cut_unique_key.py; tests/unit/retrieval/test_router_factory_hybrid.py | test | Completed |
| FR-007 | BGE text rerank + SigLIP visual default (optional ColPali) | ADR‑037 | 037 | src/retrieval/reranking.py | tests/unit/rerank/test_rerank_timeout_failopen.py; tests/unit/rerank/test_siglip_rescore_mock.py; tests/unit/rerank/test_rerank_ordering_change.py | test | Completed |
| FR-008 | Always-on hybrid + reranking (no UI toggles; env overrides only) | ADR‑024/036 | 024,036 | src/retrieval/hybrid.py; src/retrieval/reranking.py; src/pages/04_settings.py | tests/integration/test_settings_page.py | inspection | Implemented |
| FR-017 | Minimal telemetry (latency, fusion mode, reranker hits) | ADR‑032 | 032 | src/utils/telemetry.py; src/retrieval/reranking.py; src/pages/01_chat.py | tests/unit/telemetry/test_telemetry_schema_assertions.py | test | Completed |
| FR-018 | Telemetry rotation & sampling toggles | ADR‑032 | 032 | src/utils/telemetry.py | tests/unit/telemetry/test_rotation_sampling.py | test | Completed |
| FR-019 | Configurable dedup key (page_id/doc_id) | ADR‑005/006 | 005,006 | src/retrieval/hybrid.py; src/config/settings.py | tests/unit/retrieval/qdrant/test_qdrant_dedup_docid.py; tests/unit/retrieval/qdrant/test_qdrant_dedup_before_limit.py | test | Completed |
| FR‑SEC‑IMG‑ENC | AES‑GCM encryption‑at‑rest for page images | ADR‑024 | 011,024 | src/utils/security.py; src/processing/pdf_pages.py | tests/unit/utils/security/test_encrypt_file.py; tests/integration/imaging/test_pdf_images_encrypt.py | test | Completed |
| FR-009 | GraphRAG PropertyGraphIndex | ADR-019, ADR-038 | 019, 038 | src/retrieval/graph_config.py; src/retrieval/router_factory.py; src/persistence/snapshot.py; src/pages/01_chat.py; src/pages/02_documents.py | tests/unit/retrieval/test_graph_helpers.py; tests/unit/retrieval/test_seed_policy.py; tests/unit/persistence/test_snapshot_roundtrip.py; tests/unit/retrieval/test_router_factory_hybrid.py; tests/integration/ui/test_chat_autoload_snapshot.py; tests/integration/ui/test_documents_snapshot_button.py | test | Implemented |
| FR-010 | Streamlit multipage | ADR-012 | 012 | src/app.py; src/pages/04_settings.py | tests/unit/config/test_integrations_runtime.py; tests/integration/test_settings_page.py | inspection | Completed |
| FR-012 | Multi-provider UI | ADR-009 | 009 | src/config/llm_factory.py; src/pages/04_settings.py | tests/unit/config/test_llm_factory.py; tests/unit/config/test_llm_factory_empty_model_defaulting.py; tests/unit/config/test_integrations_runtime.py; tests/integration/test_settings_page.py | test | Completed |
| FR-014 | LangGraph supervisor | ADR-001 | 001 | src/agents/* | tests_agents/* | test | In repo |
| FR-020 | Prompt Template System (RichPromptTemplate, file-based) | ADR‑020 | 020 | src/prompting/*; templates/prompts/*; templates/presets/* | tests/unit/prompting/*; tests/integration/test_prompt_registry.py; tests/e2e/test_prompt_system.py | test | Completed |
